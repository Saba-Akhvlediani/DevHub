{% load static %}

<div class="card product-card h-100 position-relative" style="cursor: pointer; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;" data-product-url="{% url 'products:product_detail' product.slug %}">
    <!-- Product Image -->
    {% if product.get_main_image %}
    <img src="{{ product.get_main_image.url }}" class="card-img-top product-image" alt="{{ product.name }}" style="height: 200px; object-fit: cover; transition: transform 0.3s ease;">
    {% else %}
    <div class="card-img-top product-image bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
        <i class="fas fa-image fa-3x text-muted"></i>
    </div>
    {% endif %}
    
    <!-- Hover Actions - Right Side (Hidden by default) -->
    <div class="hover-actions position-absolute" style="top: 50px; right: 10px; z-index: 20; opacity: 0; transform: translateX(10px); transition: all 0.3s ease; pointer-events: none;">
        <!-- Add to Wishlist -->
        <form method="POST" action="{% url 'cart:add_to_wishlist' product.id %}" class="add-to-wishlist-form mb-2">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger rounded-circle action-btn shadow-sm" 
                    style="width: 40px; height: 40px; border: 2px solid #dc3545; background: white; display: flex; align-items: center; justify-content: center; padding: 0;"
                    title="Add to Wishlist">
                <i class="fas fa-heart text-danger"></i>
            </button>
        </form>
        
        <!-- Add to Compare -->
        <form method="POST" action="{% url 'cart:add_to_compare' product.id %}" class="add-to-compare-form mb-2">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-primary rounded-circle action-btn shadow-sm" 
                    style="width: 40px; height: 40px; border: 2px solid #007bff; background: white; display: flex; align-items: center; justify-content: center; padding: 0;"
                    title="Add to Compare">
                <i class="fas fa-balance-scale text-primary"></i>
            </button>
        </form>
        
        <!-- Quick View -->
        <button class="btn btn-outline-secondary rounded-circle action-btn shadow-sm quick-view-btn" 
                style="width: 40px; height: 40px; border: 2px solid #6c757d; background: white; display: flex; align-items: center; justify-content: center; padding: 0;"
                title="Quick View"
                data-product-url="{% url 'products:product_detail' product.slug %}">
            <i class="fas fa-eye text-secondary"></i>
        </button>
    </div>
    
    <!-- Shop Button - Bottom Right (Always Visible) -->
    <div class="position-absolute shop-button" style="bottom: 15px; right: 15px; z-index: 20;">
        {% if product.stock_quantity > 0 %}
        <form method="POST" action="{% url 'cart:add_to_cart' product.id %}" class="add-to-cart-form">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary rounded-circle shadow" 
                    style="width: 45px; height: 45px; border: none; background: #007bff; display: flex; align-items: center; justify-content: center; padding: 0;"
                    title="Add to Cart">
                <i class="fas fa-shopping-cart text-white"></i>
            </button>
        </form>
        {% else %}
        <button class="btn btn-secondary rounded-circle" 
                style="width: 45px; height: 45px; border: none; background: #6c757d; display: flex; align-items: center; justify-content: center; padding: 0;" 
                disabled
                title="Out of Stock">
            <i class="fas fa-times text-white"></i>
        </button>
        {% endif %}
    </div>
    
    <div class="card-body d-flex flex-column">
        <!-- Price Section (Top) -->
        <div class="mb-2">
            {% if product.original_price and product.price < product.original_price %}
            <!-- Discounted Price -->
            <div class="d-flex align-items-baseline">
                <span class="h5 mb-0 text-warning fw-bold">{{ product.price }} ₾</span>
                <small class="text-muted text-decoration-line-through ms-2">{{ product.original_price }} ₾</small>
            </div>
            {% else %}
            <!-- Regular Price -->
            <span class="h5 mb-0 text-warning fw-bold">{{ product.formatted_price }}</span>
            {% endif %}
        </div>
        
        <h6 class="card-title">{{ product.name }}</h6>
        
        {% if product.short_description %}
        <p class="card-text text-muted small">{{ product.short_description|truncatewords:8 }}</p>
        {% endif %}
        
        <!-- Stock Status -->
        <div class="mt-auto">
            {% if product.stock_quantity > 0 %}
                <span class="badge bg-success">In Stock</span>
            {% else %}
                <span class="badge bg-danger">Out of Stock</span>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Product Card Hover Effects */
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    /* Show hover actions on card hover */
    .product-card:hover .hover-actions {
        opacity: 1;
        transform: translateX(0);
        pointer-events: all;
    }

    /* Action buttons hover effects */
    .action-btn {
        transition: all 0.3s ease;
    }

    /* Wishlist button hover effect */
    .add-to-wishlist-form .action-btn:hover {
        background-color: #dc3545 !important;
        border-color: #dc3545 !important;
        transform: scale(1.1);
    }

    .add-to-wishlist-form .action-btn:hover i {
        color: white !important;
    }

    /* Compare button hover effect */
    .add-to-compare-form .action-btn:hover {
        background-color: #007bff !important;
        border-color: #007bff !important;
        transform: scale(1.1);
    }

    .add-to-compare-form .action-btn:hover i {
        color: white !important;
    }

    /* Quick view button hover effect */
    .quick-view-btn:hover {
        background-color: #6c757d !important;
        border-color: #6c757d !important;
        transform: scale(1.1);
    }

    .quick-view-btn:hover i {
        color: white !important;
    }

    /* Shop button hover effect */
    .shop-button .btn:hover {
        transform: scale(1.1);
        transition: transform 0.3s ease;
    }

    /* Product image hover effect */
    .product-card:hover .product-image {
        transform: scale(1.05);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .hover-actions {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }
        
        .action-btn {
            width: 35px !important;
            height: 35px !important;
        }
        
        .shop-button .btn {
            width: 40px !important;
            height: 40px !important;
        }
    }
</style>

<script>
    // Enhanced hover effects with JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        const productCards = document.querySelectorAll('.product-card');
        
        productCards.forEach(card => {
            const hoverActions = card.querySelector('.hover-actions');
            
            card.addEventListener('mouseenter', function() {
                // Add a slight delay for smoother effect
                setTimeout(() => {
                    if (card.matches(':hover')) {
                        hoverActions.style.opacity = '1';
                        hoverActions.style.transform = 'translateX(0)';
                        hoverActions.style.pointerEvents = 'all';
                    }
                }, 100);
            });
            
            card.addEventListener('mouseleave', function() {
                hoverActions.style.opacity = '0';
                hoverActions.style.transform = 'translateX(10px)';
                hoverActions.style.pointerEvents = 'none';
            });
        });
    });

    // Product card click functionality (avoid conflicts with buttons)
    document.querySelectorAll('.product-card').forEach(card => {
        card.addEventListener('click', function(e) {
            // Don't navigate if clicking on buttons or forms
            if (e.target.closest('button') || e.target.closest('form') || e.target.closest('input')) {
                return;
            }
            
            // Navigate to product detail page
            const productUrl = this.dataset.productUrl;
            if (productUrl) {
                window.location.href = productUrl;
            }
        });
    });

    // Quick view button functionality
    document.querySelectorAll('.quick-view-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const productUrl = this.dataset.productUrl;
            if (productUrl) {
                window.location.href = productUrl;
            }
        });
    });
</script> 